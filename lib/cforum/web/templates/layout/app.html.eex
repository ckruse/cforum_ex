<!DOCTYPE html>
<html lang="<%= Gettext.get_locale(Cforum.Web.Gettext) %>">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">

    <%= render_existing @view_module, "robots.html", assigns %>

    <meta name="description" content="<%= if @current_forum && @current_forum.description, do: @current_forum.description, else: gettext("description_text") %>">
    <meta name="keywords" content="<%= if @current_forum && @current_forum.keywords, do: @current_forum.keywords, else: gettext("keywords_text") %>">

    <meta name="DC.Publisher" content="<%= gettext("publisher") %>">
    <meta name="DC.Identifier" content="<%= controller_module(@conn) %>">
    <meta name="DC.Language" content="<%= Gettext.get_locale(Cforum.Web.Gettext) %>">

    <meta name="application-name" content="SELFHTML | F">
    <meta name="msapplication-TileImage" content="//src.selfhtml.org/logo/s-Logo_kachel_144.png">
    <meta name="msapplication-TileColor" content="#3983ab">

    <link rel="author" href="/humans.txt">

    <%# if controller_path == 'cf_threads' and action_name == 'index' and uconf('autorefresh').to_i > 0 %>
    <!-- meta http-equiv="refresh" content="<%# uconf('autorefresh').to_i * 60 %>; URL=<%# forum_url(current_forum) %>" -->
    <%# end %>

    <link rel="shortcut icon" href="//src.selfhtml.org/favicon2.ico" type="image/x-icon" title="<%= gettext("icon") %>">

    <link rel="apple-touch-icon" href="//src.selfhtml.org/logo/s-Logo_60.png">
    <link rel="apple-touch-icon-precomposed" href="//src.selfhtml.org/logo/s-Logo_144_r.png">
    <link rel="apple-touch-icon" sizes="76x76" href="//src.selfhtml.org/logo/s-Logo_76.png">
    <link rel="apple-touch-icon" sizes="120x120" href="//src.selfhtml.org/logo/s-Logo_120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="//src.selfhtml.org/logo/s-Logo_152.png">

    <link rel="help" href="<%= page_path(@conn, :help) %>" title="<%= gettext("Help") %>">
    <!--link rel="search" href="<%# search_url %>" title="<%# gettext("SELFHTML Search") %>" -->
    <%= if assigns[:link_tags], do: @link_tags %>

    <link rel="stylesheet" href="<%= static_path(@conn, "/css/app.css") %>" media="all" title="SELFHTML Forum Stylesheet">

    <%= if @current_forum do %>
      <link rel="alternate" title="<%= gettext("Atom feed (%{forum})", forum: @current_forum.name) %>" type="application/atom+xml" href="<%= atom_url(@conn) %>">
      <link rel="alternate" title="<%= gettext("RSS feed (%{forum})", forum: @current_forum.name) %>" type="application/rss+xml" href="<%= rss_url(@conn) %>">
    <% else %>
      <link rel="alternate" title="<%= gettext("Atom feed (%{forum})", forum: gettext("All forums")) %>" type="application/atom+xml" href="<%= atom_url(@conn) %>">
      <link rel="alternate" title="<%= gettext("RSS feed (%{forum})", forum: gettext("All forums")) %>" type="application/rss+xml" href="<%= rss_url(@conn) %>">
    <% end %>

    <%= if assigns[:css_style] do %><link href="<%= @css_style %>" rel="stylesheet" media="all"><% end %>
    <%= if assigns[:own_css_file] do %><link href="<%= @own_css_file %>" rel="stylesheet" media="all" title="SELFHTML Forum Stylesheet"><% end %>

    <%= if assigns[:own_css] do %>
      <style>
       <%= {:safe, @own_css} %>
      </style>
    <% end %>

    <title><%= page_title(@conn, assigns) %></title>

    <%# unless conf('css_ressource').blank? %><!-- link rel="stylesheet" href="<%# conf('css_ressource') %>" title="SELFHTML Forum Stylesheet" --><%# end %>
  </head>

  <body data-controller="<%= controller_module(@conn) %>" data-action="<%= action_name(@conn) %>"<%= body_classes(@conn, assigns) %><%= body_id(@conn, assigns) %>>

    <div class="flex-container">
      <main class="flex-item">
        <div id="alerts-container">
          <%= if get_flash(@conn, :info) do %>
            <div class="cf-success cf-alert fade in">
              <button type="button" class="close" data-dismiss="cf-alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>

              <%= get_flash(@conn, :info) %>
            </div>
          <% end %>
          <%= if get_flash(@conn, :error) do %>
            <div class="cf-error cf-alert fade in">
              <button type="button" class="close" data-dismiss="cf-alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>

              <%= get_flash(@conn, :error) %>
            </div>
            <p class="alert alert-danger" role="alert"><%= get_flash(@conn, :error) %></p>
          <% end %>
        </div>


        <%= {:safe, page_heading(@conn, assigns)} %>

        <div id="content">
          <%= render @view_module, @view_template, assigns %>
        </div>
      </main>

      <header class="top flex-item">
        <ul class="selflinks">
          <li><%= link "SELFHTML", to: "//selfhtml.org/" %></li>
          <li><%= link "Wiki", to: "//wiki.selfhtml.org/" %></li>
          <li><%= link "Forum", to: forum_path(@conn, :index) %></li>
          <li><%= link "Blog", to: "//blog.selfhtml.org/" %></li>
        </ul>
      </header>

      <ul class="personallinks flex-item">
        <%= if signed_in?(@conn) do %>
          <li id="user-info"><%= link(@current_user.username, # TODO image_tag(current_user.avatar(:thumb)) +
                             to: user_path(@conn, :show, @current_user),
                             id: "username",
                             title: gettext("%{points} points", points: @current_user.score)) %>
            <span class="score" title="<%= gettext("%{points} points", points: @current_user.score) %>">(<%= number_to_delimited(@current_user.score, precision: 0) %>)</span>
          </li>
          <li id="optionen-myadmin"><%= link gettext("settings"), to: user_path(@conn, :edit, @current_user) %></li>
          <li id="user-notifications"><%= link(gettext("notifications"), to: "", title: gettext("new notifications", count: 0)) # TODO @new_notifications.length %>
            (<span class="notifications<%# if @new_notifications.length > 0 %> new<%# end %>"
                   id="notifications-display"
                   title="<%= gettext("new notifications", count: 0) # TODO @new_notifications.length %>"><%= 0 # TODO @new_notifications.length %></span>)
          </li>
          <li id="post-link"><%= link(gettext("mail"), to: "", title: gettext("%{count} new mails", count: 0)) # TODO @new_mails.length %>
            (<span class="mails new" id="mails" title="<%= gettext("%{count} new mails", count: 0) # TODO @new_mails.length %>"><%= 0 # TODO @new_mails.length %></span>)</li>
          <li id="optionen-logout"><%= link(gettext("logout"), to: session_path(@conn, :delete), method: :delete) %></li>
        <% else %>
          <li id="user-not-signed-in"><%= img_tag(static_path(@conn, "/images/missing.png")) %> <%= gettext("not logged in") %></li>
          <li id="optionen-help"><%= link(gettext("Help"), to: page_path(@conn, :help)) %></li>
          <li id="optionen-my"><%= link(gettext("login"), to: session_path(@conn, :new), rel: "nofollow") %></li>
          <li id="optionen-myadmin"><%= link(gettext("register"), to: registration_path(@conn, :new), rel: "nofollow") %></li>
        <% end %>
      </ul>



      <header class="flex-container flex-item page-header">
        <div class="flex-item logo">
          <h1><span>SELFHTML Forum - Ergänzung zur <%= link "Dokumentation", to: "https://wiki.selfhtml.org" %></span><%= link "", to: forum_path(@conn, :index), class: "home" %></h1>
          <%= if @current_forum do %>
            <%= link(img_tag(static_path(@conn, "/images/feed-rss.svg"), alt: gettext("RSS feed (%{forum})", forum: @current_forum.name)), to: rss_url(@conn), title: gettext("RSS feed (%{forum})", forum: @current_forum.name), class: "rss") %>
            <%= link(img_tag(static_path(@conn, "/images/feed-atom.svg"), alt: gettext("Atom feed (%{forum})", forum: @current_forum.name)), to: atom_url(@conn), title: gettext("Atom feed (%{forum})", forum: @current_forum.name), class: "atom") %>
          <% else %>
            <%= link(img_tag(static_path(@conn, "/images/feed-rss.svg"), alt: gettext("RSS feed (%{forum})", forum: gettext("All forums"))), to: rss_url(@conn), title: gettext("RSS feed (%{forum})", forum: gettext("All forums")), class: "rss") %>
            <%= link(img_tag(static_path(@conn, "/images/feed-atom.svg"), alt: gettext("Atom feed (%{forum})", forum: gettext("All forums"))), to: atom_url(@conn), title: gettext("Atom feed (%{forum})", forum: gettext("All forums")), class: "atom") %>
          <% end %>

          <%= link(img_tag(static_path(@conn, "/images/donate.svg"), alt: gettext("donate")), to: "https://selfhtml.org/spenden.html", title: gettext("donate"), class: "donate") %>
        </div>

        <nav class="flex-item quicklinks">
          <ul>
            <li><%= link gettext("create new thread"), to: "" %></li>
            <li><%= link gettext("home"), to: forum_path(@conn, :index) %></li>
            <li class="dropdown"><span class="anchor"><%= gettext("Forums") %></span>
              <ul class="menu">
                <li<% if !@current_forum && controller_module(@conn) == Cforum.ThreadController do %> class="active"<% end %>>
                  <%= link gettext("All forums"), to: thread_path(@conn, :index, "all") %>
                  <%= link to: "", title: gettext("Statistics"), class: "stats" do %>
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0" y="0" width="22" height="14" viewBox="0, 0, 22, 14">
                      <g id="stats-icon">
                        <path d="M-0.001,13 L21.999,13 L21.999,14 L-0.001,14 z" fill="#BFBFBF"/>
                        <path d="M17,-0.001 L20,-0.001 L20,12.999 L17,12.999 z" fill="#8CB433"/>
                        <path d="M12,4 L15,4 L15,13 L12,13 z" fill="#5C7FDD"/>
                        <path d="M7,2 L10,2 L10,13 L7,13 z" fill="#E7C248"/>
                        <path d="M2,7 L5,7 L5,13 L2,13 z" fill="#C52D00"/>
                      </g>
                    </svg>
                  <% end %>
                </li>
                <%= for f <- @visible_forums do %>
                  <li<%= if @current_forum == f do %> class="active"<% end %>>
                    <%= link f.name, to: thread_path(@conn, :index, f) %>
                    <%= link to: "", title: gettext("Statistics"), class: "stats" do %>
                      <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0" y="0" width="22" height="14" viewBox="0, 0, 22, 14">
                        <use xlink:href="#stats-icon"></use>
                      </svg>
                    <% end %>
                  </li>
                <% end %>
              </ul>
            </li>
            <li class="cites">
              <%= link gettext("Cites"), to: "" %>
              <%= if false do %>(<%= link "#{@undeceided_cites}", to: "" %>)<% end %><!-- TODO -->
            </li>
            <li><%= link gettext("Search"), to: "" %></li>
            <li><%= link gettext("Chat"), to: "https://kiwiirc.com/client/irc.epd-me.net/?nick=&channel=#selfhtml", rel: "nofollow" %></li> <!-- TODO (current_user.try(:username) || "Guest%7C" + rand(9999).to_s) -->
            <li><%= link(gettext("Help"), to: page_path(@conn, :help)) %></li>
            <%= if controller_module(@conn) != Cforum.SearchController do %>
              <li class="search">
                <%# form_tag search_path + '#results', method: 'get', rel: 'nofollow' do %>
                <%# hidden_field_tag 'sections[]', 1, id: nil %>
                <%# hidden_field_tag 'sections[]', 2, id: nil %>
                <%# search_field_tag 'term', params[:term], placeholder: t('search.search_top') %>
                <%# end %>
              </li> <!-- TODO -->
            <% end %>
          </ul>
        </nav>


        <nav class="flex-item subnav">
          <%= render_existing @view_module, "subnav.html", assigns %>

          <ul>
            <%= if @current_forum do %>
              <li><%= link @current_forum.name, to: thread_path(@conn, :index, @current_forum) %></li>
            <% end %>

            <%= if assigns[:message] != nil && assigns[:thread] != nil && !@thread.new_record? do %>
              <%= if @read_mode != "thread-view" do %>
                <li><%= link(gettext("thread view"), to: "") %></li>
              <% else %>
                <li><%= link(gettext("nested view"), to: "") %></li>
              <% end %>
            <% end %>

            <%= if controller_module(@conn) == Cforum.Threads && @current_user == nil do %>
              <%= if @order != "ascending" do %>
                <li><%= link(gettext("sort ascending"), to: thread_path(@conn, :index, @current_forum, p: @page, order: "ascending")) %></li>
              <% end %>
              <%= if @order != "descending" do %>
                <li><%= link(gettext("sort descending"), to: thread_path(@conn, :index, @current_forum, p: @page, order: "descending")) %></li>
              <% end %>
              <%= if @order != "newest-first" do %>
                <li><%= link(gettext("sort newest first"), to: thread_path(@conn, :index, @current_forum, p: @page, order: "newest-first")) %></li>
              <% end %>
            <% end %>

            <%= if assigns[:thread] != nil && !@thread.new_record? do %>
              <li id="nachricht-feed-atom"><%= link gettext("Atom feed"), to: "" %></li> <!-- TODO atom_url for thread -->
              <li id="nachricht-feed-rss"><%= link gettext("RSS feed"), to: "" %></li> <!-- TODO rss_url for thread -->
            <% end %>

            <%= if false do %> <!-- TODO current_user.try(:admin) -->
              <li><%= link gettext("Administration"), "" %></li>
            <% end %>

            <%# if current_user.try(:moderate?, current_forum) %>
            <%#
            path = nil
            if @message.blank?
            path = cf_threads_path(current_forum, view_all: @view_all ? nil : "yes")
            else
            path = message_path(@thread, @message, view_all: @view_all ? nil : "yes")
            end
            %>
            <%# if @view_all %>
            <!--li id="admin-view"><%# cf_link_to t("forums.normal_view"), path %></li> -->
            <%# else %>
            <!--li id="admin-view"><%# cf_link_to t("forums.admin_view"), path %></li> -->
            <%# end %>
            <%# end %>

            <% if Enum.member?([ThreadController, MessageController, ArchiveController], controller_module(@conn)) do %>
              <li id="link-archiv"><%= link gettext("archive"), to: "" %></li>
            <% end %>

            <%# if threads && current_user && !controller_path.in?(%w(interesting_messages_plugin hidden_threads_plugin)) %>
            <!--li id="mark-all-read"><%# cf_link_to(t("plugins.mark_read.mark_all_read"),
                                   mark_all_read_path(current_forum, std_args),
                                   method: :post) %></li> -->
            <!--li id="optionen-close-all-threads"><%# cf_link_to t('plugins.open_close.close_all_threads'), close_all_threads_path(current_forum, std_args), method: :post %></li> -->
            <!--li id="optionen-open-all-threads"><%# cf_link_to t('plugins.open_close.open_all_threads'), open_all_threads_path(current_forum, std_args), method: :post %></li> -->

            <%# if uconf('hide_read_threads') == 'yes' %>
            <%# if session[:srt] %>
            <!--li id="optionen-hide-read-threads"><%# cf_link_to t('plugins.hide_read_threads.hide_read_threads'), forum_path(current_forum, 'srt' => 'no') %></li> -->
                <%# else %>
            <!--li id="optionen-show-read-threads"><%# cf_link_to t('plugins.hide_read_threads.show_read_threads'), forum_path(current_forum, 'srt' => 'yes') %></li> -->
                <%# end %>
              <%# end %>
            <%# end %>

            <%# if current_user && ((@threads && !controller_path.in?(%w(interesting_messages_plugin hidden_threads_plugin))) || controller_path.in?(%w(forums users))) %>
            <!--li id="interesting-links"><%# cf_link_to t('plugins.interesting_messages.interesting_messages'), interesting_messages_path %></li> -->
            <!--li id="invisible-links"><%# cf_link_to t('plugins.invisible_threads.invisible_threads'), hidden_threads_path %></li> -->
            <%# end %>

            <%= if controller_module(@conn) == Cforum.ForumController do %>
              <li id="events-link"><%# cf_link_to t('events.events'), events_path %></li>
            <% end %>
          </ul>
        </nav>

      </header>

      <%# if not @motds.blank? or content_for?(:aside) %>
      <!--aside class="flex-item" -->
        <%# if not @motds.blank? %>
        <%# @motds.each do |motd| %>
        <!--div class="aktuelle-mitteilung"><%# motd %></div-->
            <%# end %>
          <%# end %>

          <%# content_for :aside %>
      <!--/aside-->
      <%# end %>

    </div>

    <footer>
      <ul>
        <li>Seit 1995 — <%= link "Die Energie des Verstehens", to: "//selfhtml.org/" %></li>
        <li><%= link "Impressum", to: "//selfhtml.org/impressum.html" %></li>
        <li><%= link "Datenschutz", to: "//selfhtml.org/impressum.html#datenschutz" %></li>
        <li>Software: <%= link "Classic Forum", to: "https://github.com/ckruse/cforum" %></li>
      </ul>

      <p class="termitel-sponsor"><%= link to: "https://termitel.de/" do %><%= img_tag(static_path(@conn, "/images/termitel-fuer-ihren-vertrieb.jpg"), alt: "Termitel - für Ihren Vertrieb") %><% end %></p>
    </footer>

    <script src="<%= static_path(@conn, "/js/app.js") %>"></script>
    <%= if assigns[:own_js_file] do %><script src="<%= @own_js_file %>"></script><% end %>

    <%# if @own_js %><!--script>
                          <%# @own_js.html_safe %>
                          </script --><%# end %>

    <!--script>
         <%# if current_user %>
         cforum.currentUser = <%# current_user.to_json(include: [:badges, settings: {only: :options}]).html_safe %>;
         cforum.websocketToken = <%# current_user.websocket_token.to_json.html_safe %>;
         <%# end %>
         cforum.baseUrl = <%# root_url.to_json.html_safe %>;
         cforum.basePath = <%# root_path.to_json.html_safe %>;
         <%# if current_forum %>cforum.currentForum = <%# current_forum.to_json.html_safe %>;<%# end %>
         <%# if @max_tags %>cforum.tags.maxTags = <%# @max_tags %>;<%# end %>

         cforum.l10n = <%# I18n.t('js.messages').to_json.html_safe %>;
         cforum.locale = <%# I18n.locale.to_json %>;
         cforum.userForums = <%# @forums.to_json %>;
         cforum.viewAll = <%# @view_all.to_json %>;
         cforum.imageMaxSize = <%# conf("max_image_filesize") %>;
         </script-->

    <%# unless conf('js_ressource').blank? %><!--script src="<%# conf('js_ressource') %>"></script><%# end %> -->

    <%# if Rails.env != 'test' %>
    <!--script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
         <script>
         if(typeof MathJax != 'undefined') {
         MathJax.Hub.Config({
         displayAlign: "left",
         menuSettings: { CHTMLpreview: false },
         tex2jax: {
         inlineMath: [],
         displayMath: []
         }
         });
         }
         </script -->
    <%# end %>

    <%# yield(:additional_js) %>

  </body>
</html>




